(function() {

	'use strict';

	var mobileMenuOutsideClick = function() {
			$(document).click(function(e) {
				var container = $("#azkaban-offcanvas, .js-azkaban-nav-toggle");
				if (!container.is(e.target) && container.has(e.target).length === 0) {

					if ($('body').hasClass('offcanvas')) {

						$('body').removeClass('offcanvas');
						$('.js-azkaban-nav-toggle').removeClass('active');
					}
				}
			});
		};

	var offcanvasMenu = function() {
			$('#azkaban-page').prepend('<div id="azkaban-offcanvas" />');
			$('#azkaban-page').prepend('<a href="#" class="js-azkaban-nav-toggle azkaban-nav-toggle azkaban-nav-white"><i></i></a>');
			var clone1 = $('.menu-1 > ul').clone();
			$('#azkaban-offcanvas').append(clone1);
			var clone2 = $('.menu-2 > ul').clone();
			$('#azkaban-offcanvas').append(clone2);
			$('#azkaban-offcanvas .has-dropdown').addClass('offcanvas-has-dropdown');
			$('#azkaban-offcanvas').find('li').removeClass('has-dropdown');
			$('.offcanvas-has-dropdown').mouseenter(function() {
				var $this = $(this);
				$this.addClass('active').find('ul').slideDown(500, 'easeOutExpo');
			}).mouseleave(function() {
				var $this = $(this);
				$this.removeClass('active').find('ul').slideUp(500, 'easeOutExpo');
			});
			$(window).resize(function() {
				if ($('body').hasClass('offcanvas')) {
					$('body').removeClass('offcanvas');
					$('.js-azkaban-nav-toggle').removeClass('active');
				}
			});
		};


	var burgerMenu = function() {
			$('body').on('click', '.js-azkaban-nav-toggle', function(event) {
				var $this = $(this);
				if ($('body').hasClass('overflow offcanvas')) {
					$('body').removeClass('overflow offcanvas');
				} else {
					$('body').addClass('overflow offcanvas');
				}
				$this.toggleClass('active');
				event.preventDefault();
			});
		};

	var dropdown = function() {

			$('.has-dropdown').mouseenter(function() {
				var $this = $(this);
				$this.find('.dropdown').css('display', 'block').addClass('animated-fast fadeInUpMenu');
			}).mouseleave(function() {
				var $this = $(this);
				$this.find('.dropdown').css('display', 'none').removeClass('animated-fast fadeInUpMenu');
			});

		};

	var shareMenu = function() {
			$(".Share").click(function() {
				$(".share-wrap").fadeToggle("slow");
			});
			$('.qrcode').each(function(index, el) {
				var url = $(this).data('url');
				if ($.fn.qrcode) {
					$(this).qrcode({
						text: url,
						width: 150,
						height: 150,
					});
				}
			});
		}

	var showlove = function() {
			$.fn.postLike = function() {
				if ($(this).hasClass('done')) {
					layer.msg('您已经支持过了', function() {});
					return false;
				} else {
					$(this).addClass('done');
					layer.msg('感谢您的支持');
					var id = $(this).data("id"),
						action = $(this).data('action'),
						rateHolder = $(this).children('.count');
					var ajax_data = {
						action: "love",
						um_id: id,
						um_action: action
					};
					$.post("/wp-admin/admin-ajax.php", ajax_data, function(data) {
						$(rateHolder).html(data);
					});
					return false;
				}
			};
			$(document).on("click", ".Love", function() {
				$(this).postLike();
			});
		}

	var goToTop = function() {
			$('.js-gotop').on('click', function(event) {
				event.preventDefault();
				$('html, body').animate({
					scrollTop: $('html').offset().top
				}, 500, 'easeInOutExpo');
				return false;
			});

			$(window).scroll(function() {
				var $win = $(window);
				if ($win.scrollTop() > 200) {
					$('.js-top').addClass('active');
				} else {
					$('.js-top').removeClass('active');
				}
			});
		};

	var toSearch = function() {
			$('.search').on("click", function(e) {
				$("#searchform").animate({width:"200px"},200),
				$("#searchform input").css('display','block');
				$(document).one("click", function() {
					$("#searchform").animate({width:"0"},100),
					$("#searchform input").hide();
				});
				e.stopPropagation();
			});
			$('#searchform').on("click", function(e) {e.stopPropagation();})
		};

	var showPhotos = function() {
			layer.photos({
			  photos: '.azkaban-post-content'
			  ,anim: 0
			}); 
		}

	var scrollArticle = function(){
		$("#articlepage").on('click','a', function(){     
		    $(this).addClass('loading').text('加载中');
		    var href = $(this).attr("href");
		    if (href != undefined) {
		        $.ajax( {
		            url: href,
		            type: "get",
		        error: function(request) {},   
		        success: function(data) {
		            $("#articlepage a").removeClass('loading').text('加载更多'); 
		            var $res = $(data).find(".card");
		            $('#content').append($res.fadeIn('slow'));
		            var newhref = $(data).find("#articlepage a").attr("href");
		            if( newhref != undefined ){   
		                $("#articlepage a").attr("href",newhref);   
		            }else{   
		                $("#articlepage").hide();
		            }   
		        }   
		        });   
		    }   
		    return false;   
		});
	};

	$(function() {
		mobileMenuOutsideClick();
		offcanvasMenu();
		burgerMenu();
		dropdown();
		shareMenu();
		showlove();
		goToTop();
		toSearch();
		showPhotos();
		scrollArticle();
	});
	
}());